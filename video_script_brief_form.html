<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Script Brief Form</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Add Supabase -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'
        
        // Initialize Supabase client
        const supabaseUrl = 'YOUR_SUPABASE_URL'
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY'
        const supabase = createClient(supabaseUrl, supabaseKey)
        
        // Make supabase available globally
        window.supabase = supabase;
        
        // File upload function
        window.uploadFile = async function(file) {
            try {
                const fileExt = file.name.split('.').pop()
                const fileName = `${Math.random().toString(36).substring(2)}.${fileExt}`
                const filePath = `${fileName}`
                
                const { data, error } = await supabase.storage
                    .from('uploads')
                    .upload(filePath, file)
                
                if (error) throw error
                
                // Get public URL
                const { data: { publicUrl } } = supabase.storage
                    .from('uploads')
                    .getPublicUrl(filePath)
                
                return publicUrl
            } catch (error) {
                console.error('Error uploading file:', error)
                throw error
            }
        }
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background: #f8f9fa;
        }

        .app-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .app-logo {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0071e3;
            border-radius: 12px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .logo-svg {
            width: 100%;
            height: 100%;
            padding: 12px;
        }

        .app-title {
            font-size: 28px;
            font-weight: 600;
            color: #1d1d1f;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        .app-subtitle {
            font-size: 14px;
            color: #86868b;
            font-weight: normal;
            margin-top: 4px;
        }

        .form-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }

        .section-header {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #1d1d1f;
            margin: 0 0 8px 0;
        }

        .section-description {
            font-size: 16px;
            color: #86868b;
            margin: 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #1d1d1f;
        }
        .helper-text {
            display: block;
            margin: 4px 0 8px 0;
            font-size: 14px;
            color: #86868b;
            line-height: 1.4;
        }
        select, input[type="text"], input[type="date"], textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            margin-top: 4px;
            background-color: white;
            cursor: pointer;
        }
        .input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }
        .input-wrapper label {
            display: block;
            margin-bottom: 4px;
            font-size: 16px;
            font-weight: 500;
            color: #1d1d1f;
        }
        .input-wrapper .helper-text {
            margin: 4px 0 8px 0;
        }
        .url-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        .url-input-wrapper::before {
            content: 'https://';
            position: absolute;
            left: 12px;
            color: #666;
            font-size: 14px;
            pointer-events: none;
            background: #f0f0f0;
            padding: 8px 0;
            border-right: 1px solid #e0e0e0;
            border-radius: 6px 0 0 6px;
            width: 70px;
            text-align: center;
        }
        .url-input-wrapper input {
            padding-left: 90px;
            border-radius: 6px;
            width: 100%;
        }
        .checkbox-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        button {
            background: #0071e3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0077ed;
        }
        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .script-preview {
            background: #1d1d1f;
            color: #f5f5f7;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'SF Mono', monospace;
            white-space: pre-wrap;
            line-height: 1.6;
            position: relative;
            min-height: 300px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .script-preview.editable {
            background: #2d2d2d;
            border: 1px solid #3d3d3d;
        }
        
        .script-preview.editable:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }
        
        .script-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .script-controls button {
            padding: 8px 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .script-controls button i {
            font-size: 16px;
        }
        
        .script-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }
        
        .script-section h2 {
            color: #0071e3;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .script-section h3 {
            color: #86868b;
            font-size: 16px;
            margin: 15px 0 8px 0;
        }
        
        .script-timing {
            color: #86868b;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .script-narration {
            color: #f5f5f7;
            font-style: italic;
            margin: 10px 0;
            padding-left: 20px;
            border-left: 2px solid #0071e3;
        }
        
        .script-direction {
            color: #86868b;
            font-size: 14px;
            margin: 5px 0;
        }
        
        .script-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .script-preview:hover .script-actions {
            opacity: 1;
        }
        
        .script-action-button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #f5f5f7;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .script-action-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .script-edit-mode .script-section {
            cursor: text;
        }
        
        .script-edit-mode .script-section:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .script-edit-mode .script-section:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }
        
        .script-formatting-toolbar {
            display: flex;
            gap: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .format-button {
            background: none;
            border: none;
            color: #f5f5f7;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .format-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .format-button.active {
            background: #0071e3;
            color: white;
        }
        
        .timeline {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f7;
            border-radius: 6px;
        }
        
        .timeline-segment {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: #0071e3;
            color: white;
            border-radius: 4px;
        }
        
        .customization-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .preview-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .tone-selector {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .tone-option {
            padding: 5px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .tone-option.active {
            background: #0071e3;
            color: white;
        }
        
        .advanced-options {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f7;
            border-radius: 8px;
        }
        
        .tone-variations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .tone-card {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tone-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .tone-card.active {
            background: #0071e3;
            color: white;
            border-color: #0071e3;
        }
        
        .preview-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .preview-section {
            background: #1d1d1f;
            color: #f5f5f7;
            padding: 20px;
            border-radius: 8px;
            font-family: 'SF Mono', monospace;
        }
        
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .export-option {
            padding: 10px;
            background: #f5f5f7;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .export-option:hover {
            background: #0071e3;
            color: white;
        }
        
        .timeline-visualization {
            position: relative;
            height: 100px;
            background: #2d2d2d;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .timeline-segment {
            position: absolute;
            height: 100%;
            background: #0071e3;
            transition: all 0.3s ease;
        }
        
        .timeline-segment:hover {
            filter: brightness(1.2);
        }
        
        .timeline-label {
            position: absolute;
            color: white;
            font-size: 12px;
            padding: 5px;
            white-space: nowrap;
        }
        
        .preview-option {
            padding: 5px 10px;
            background: #f5f5f7;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .preview-option.active {
            background: #0071e3;
            color: white;
        }
        
        .language-preview {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f7;
            border-radius: 4px;
        }
        
        .language-preview.active {
            display: block;
        }
        
        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            z-index: 1000;
        }

        .error-message {
            color: #ff3b30;
            padding: 10px;
            text-align: center;
        }

        .timeline-label {
            position: absolute;
            color: white;
            font-size: 12px;
            padding: 5px;
            white-space: nowrap;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            pointer-events: none;
        }

        @media (max-width: 600px) {
            .timeline-label {
                font-size: 10px;
                padding: 3px;
            }
            
            .preview-panel {
                grid-template-columns: 1fr;
            }
        }

        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 32px;
        }

        select:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        select option {
            padding: 8px;
            background-color: white;
            color: #1d1d1f;
        }

        select[multiple] {
            height: auto;
            min-height: 100px;
            padding: 4px;
        }

        select[multiple] option {
            padding: 4px 8px;
            margin: 2px 0;
            border-radius: 4px;
        }

        select[multiple] option:checked {
            background-color: #0071e3;
            color: white;
        }

        /* Tab Navigation Styles */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .tab-button {
            padding: 8px 16px;
            border: none;
            background: none;
            color: #86868b;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 6px;
        }

        .tab-button:hover {
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .tab-button.active {
            color: #0071e3;
            background: #f5f5f7;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Selection Button Styles */
        .selection-button {
            padding: 8px 16px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 4px;
        }

        .selection-button:hover {
            border-color: #0071e3;
            color: #0071e3;
        }

        .selection-button.active {
            background: #0071e3;
            color: white;
            border-color: #0071e3;
        }

        .selection-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }

        /* Add Font Awesome for icons */
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css');

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 400px;
            background: #2d2d2d;
            border-radius: 8px;
            margin-top: 20px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .chat-message {
            margin-bottom: 15px;
            max-width: 80%;
        }

        .chat-message.user {
            margin-left: auto;
        }

        .chat-message.assistant {
            margin-right: auto;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 12px;
            background: #3d3d3d;
            color: #f5f5f7;
        }

        .chat-message.user .message-content {
            background: #0071e3;
        }

        .chat-message.assistant .message-content {
            background: #3d3d3d;
        }

        .message-time {
            font-size: 12px;
            color: #86868b;
            margin-top: 4px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: #1d1d1f;
            border-top: 1px solid #3d3d3d;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #3d3d3d;
            border-radius: 6px;
            background: #2d2d2d;
            color: #f5f5f7;
        }

        .chat-input button {
            padding: 10px 20px;
        }

        .feedback-section {
            margin-top: 20px;
            padding: 20px;
            background: #2d2d2d;
            border-radius: 8px;
        }

        .feedback-item {
            margin-bottom: 15px;
            padding: 15px;
            background: #3d3d3d;
            border-radius: 6px;
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .feedback-author {
            font-weight: 500;
            color: #0071e3;
        }

        .feedback-time {
            color: #86868b;
            font-size: 14px;
        }

        .feedback-content {
            color: #f5f5f7;
            margin-bottom: 10px;
        }

        .feedback-actions {
            display: flex;
            gap: 10px;
        }

        .feedback-action {
            background: none;
            border: none;
            color: #86868b;
            cursor: pointer;
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .feedback-action:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #f5f5f7;
        }

        .script-version {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .version-selector {
            padding: 8px;
            border: 1px solid #3d3d3d;
            border-radius: 6px;
            background: #2d2d2d;
            color: #f5f5f7;
        }

        .version-info {
            color: #86868b;
            font-size: 14px;
        }

        .script-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-panel {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
        }

        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .comparison-title {
            color: #f5f5f7;
            font-size: 16px;
            font-weight: 500;
        }

        .comparison-timestamp {
            color: #86868b;
            font-size: 14px;
        }

        .script-workspace {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .script-main {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .script-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .script-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .script-controls {
            display: flex;
            gap: 10px;
        }

        .script-version-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-size: 14px;
        }

        .script-preview {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            color: #333;
        }

        .script-preview.editable {
            border-color: #0071e3;
        }

        .script-preview.editable:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        .chat-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            height: 300px;
            margin-top: 0;
        }

        .chat-messages {
            padding: 15px;
            overflow-y: auto;
            height: calc(100% - 60px);
        }

        .chat-message {
            margin-bottom: 15px;
            max-width: 80%;
        }

        .chat-message.user {
            margin-left: auto;
        }

        .chat-message.assistant {
            margin-right: auto;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 12px;
            background: #f0f0f0;
            color: #333;
        }

        .chat-message.user .message-content {
            background: #0071e3;
            color: white;
        }

        .chat-message.assistant .message-content {
            background: #f0f0f0;
            color: #333;
        }

        .chat-input {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            color: #333;
        }

        .feedback-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 0;
        }

        .feedback-item {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .script-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .toolbar-group {
            display: flex;
            gap: 10px;
        }

        .toolbar-button {
            background: #f0f0f0;
            border: 1px solid #e0e0e0;
            color: #333;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .toolbar-button:hover {
            background: #e0e0e0;
        }

        .toolbar-button.active {
            background: #0071e3;
            color: white;
            border-color: #0071e3;
        }

        .version-badge {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
            border: 1px solid #e0e0e0;
        }

        .selection-button {
            background: white;
            border: 1px solid #e0e0e0;
            color: #333;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .selection-button:hover {
            border-color: #0071e3;
            color: #0071e3;
        }

        .selection-button.active {
            background: #0071e3;
            color: white;
            border-color: #0071e3;
        }

        .tab-button {
            background: white;
            border: 1px solid #e0e0e0;
            color: #666;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-button:hover {
            background: #f0f0f0;
            color: #333;
        }

        .tab-button.active {
            background: #0071e3;
            color: white;
            border-color: #0071e3;
        }

        .export-option {
            background: white;
            border: 1px solid #e0e0e0;
            color: #333;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .export-option:hover {
            background: #0071e3;
            color: white;
            border-color: #0071e3;
        }

        .industry-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .industry-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .industry-card:hover {
            border-color: #0071e3;
            transform: translateY(-2px);
        }

        .industry-card.active {
            background: #0071e3;
            color: white;
            border-color: #0071e3;
        }

        .industry-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .audience-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .audience-tag {
            display: inline-block;
            background: #f0f0f0;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            padding: 6px 12px;
            margin: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .audience-tag:hover {
            background: #e0e0e0;
        }

        .audience-tag.active {
            background: #0071e3;
            color: white;
            border-color: #0071e3;
        }

        .script-insights {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #666;
            font-size: 14px;
        }

        .insight-item i {
            color: #0071e3;
        }

        .upload-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 20px;
            background: white;
        }

        .upload-area:hover {
            border-color: #0071e3;
            background: #f8f9fa;
        }

        .upload-area.dragover {
            border-color: #0071e3;
            background: #f8f9fa;
            transform: scale(1.02);
        }

        .upload-area i {
            font-size: 48px;
            color: #0071e3;
            margin-bottom: 15px;
        }

        .upload-area p {
            color: #666;
            margin: 10px 0;
        }

        .upload-area .file-types {
            font-size: 12px;
            color: #86868b;
        }

        .uploaded-files {
            margin-top: 20px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .file-item:hover {
            background: #f0f0f0;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .file-icon {
            font-size: 24px;
            color: #0071e3;
        }

        .file-name {
            font-size: 14px;
            color: #333;
            word-break: break-all;
        }

        .file-size {
            font-size: 12px;
            color: #86868b;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .file-action {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .file-action:hover {
            background: #e0e0e0;
            color: #333;
        }

        .file-action.delete:hover {
            background: #ffebee;
            color: #d32f2f;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 6px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .notification.error {
            background: #ffebee;
            color: #d32f2f;
        }

        .notification.info {
            background: #e3f2fd;
            color: #1976d2;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.fade-out {
            animation: fadeOut 0.3s ease forwards;
        }

        @keyframes fadeOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .content-analysis {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .analysis-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .analysis-icon {
            font-size: 18px;
            color: #0071e3;
        }

        .analysis-text {
            font-size: 14px;
            color: #333;
        }

        .analysis-status {
            margin-left: auto;
            font-size: 12px;
            color: #86868b;
        }

        .file-item {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .file-item.removing {
            transform: translateX(100%);
            opacity: 0;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 12px;
            color: #666;
        }

        .upload-status {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .upload-status.completed {
            color: #28a745;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .file-actions button {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            color: #666;
            transition: color 0.2s ease;
        }

        .file-actions button:hover {
            color: #333;
        }

        .file-actions button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: #e9ecef;
            border-radius: 0 0 6px 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #007bff;
            width: 0;
            transition: width 0.3s ease;
        }

        .file-preview-image {
            width: 40px;
            height: 40px;
            background-size: cover;
            background-position: center;
            border-radius: 4px;
            margin-right: 12px;
        }

        .preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .preview-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }

        .preview-image {
            max-width: 100%;
            max-height: 90vh;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        .close-preview {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .retry-button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .retry-button:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="app-logo">
            <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <!-- Film Strip Background -->
                <rect x="10" y="10" width="80" height="80" rx="8" fill="#0071e3"/>
                
                <!-- Film Perforations -->
                <rect x="15" y="20" width="5" height="5" rx="1" fill="white"/>
                <rect x="15" y="35" width="5" height="5" rx="1" fill="white"/>
                <rect x="15" y="50" width="5" height="5" rx="1" fill="white"/>
                <rect x="15" y="65" width="5" height="5" rx="1" fill="white"/>
                
                <rect x="80" y="20" width="5" height="5" rx="1" fill="white"/>
                <rect x="80" y="35" width="5" height="5" rx="1" fill="white"/>
                <rect x="80" y="50" width="5" height="5" rx="1" fill="white"/>
                <rect x="80" y="65" width="5" height="5" rx="1" fill="white"/>
                
                <!-- Script Lines -->
                <line x1="30" y1="30" x2="70" y2="30" stroke="white" stroke-width="2"/>
                <line x1="30" y1="40" x2="70" y2="40" stroke="white" stroke-width="2"/>
                <line x1="30" y1="50" x2="70" y2="50" stroke="white" stroke-width="2"/>
                <line x1="30" y1="60" x2="70" y2="60" stroke="white" stroke-width="2"/>
                
                <!-- Play Button -->
                <path d="M45 35 L65 50 L45 65 Z" fill="white"/>
            </svg>
        </div>
        <h1 class="app-title">
            Video Script Generator
            <span class="app-subtitle">Create compelling video scripts with AI</span>
        </h1>
    </div>
    <form id="videoScriptForm">
        <div class="tab-navigation">
            <button type="button" class="tab-button active" data-tab="project-overview">Project Overview</button>
            <button type="button" class="tab-button" data-tab="brand-guidelines">Brand Guidelines</button>
            <button type="button" class="tab-button" data-tab="technical-specs">Technical Specifications</button>
            <button type="button" class="tab-button" data-tab="script-workspace">Script Workspace</button>
            <button type="button" class="tab-button" data-tab="export-options">Export Options</button>
        </div>

        <div id="project-overview" class="tab-content active">
            <div class="form-section">
                <div class="section-header">
                    <h2 class="section-title">Project Overview</h2>
                    <p class="section-description">Define the basic information about your video project</p>
                </div>
                <div class="form-group">
                    <label for="projectName">Project Name</label>
                    <small class="helper-text">Enter a descriptive name for your video project</small>
                    <input type="text" id="projectName" name="projectName" required>
                </div>
                <div class="form-group">
                    <label for="client">Client</label>
                    <small class="helper-text">Enter the client or company name</small>
                    <input type="text" id="client" name="client" required>
                </div>
                <div class="form-group">
                    <label for="companyUrl">Company URL</label>
                    <small class="helper-text">Enter the company's website URL to help generate relevant content</small>
                    <div class="url-input-wrapper">
                        <input type="text" id="companyUrl" name="companyUrl" placeholder="www.example.com" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Project Type</label>
                    <small class="helper-text">Select the type of video you're creating</small>
                    <div class="selection-group" id="projectTypeGroup">
                        <button type="button" class="selection-button" data-value="brand">Brand Video</button>
                        <button type="button" class="selection-button" data-value="product">Product Launch</button>
                        <button type="button" class="selection-button" data-value="social">Social Media</button>
                        <button type="button" class="selection-button" data-value="educational">Educational</button>
                        <button type="button" class="selection-button" data-value="other">Other</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Target Platform</label>
                    <small class="helper-text">Select where your video will be published</small>
                    <div class="selection-group" id="targetPlatformGroup">
                        <button type="button" class="selection-button" data-value="website">Website</button>
                        <button type="button" class="selection-button" data-value="social">Social Media</button>
                        <button type="button" class="selection-button" data-value="tv">TV</button>
                        <button type="button" class="selection-button" data-value="event">Event</button>
                        <button type="button" class="selection-button" data-value="other">Other</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Video Duration</label>
                    <small class="helper-text">Choose the length of your video</small>
                    <div class="selection-group" id="durationGroup">
                        <button type="button" class="selection-button" data-value="10">10 seconds</button>
                        <button type="button" class="selection-button" data-value="15">15 seconds</button>
                        <button type="button" class="selection-button" data-value="30">30 seconds</button>
                        <button type="button" class="selection-button" data-value="60">1 minute</button>
                        <button type="button" class="selection-button" data-value="90">1.5 minutes</button>
                        <button type="button" class="selection-button" data-value="120">2 minutes</button>
                        <button type="button" class="selection-button" data-value="custom">Custom</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="videoDescription">Video Description</label>
                    <small class="helper-text">Describe what you want to see in your video</small>
                    <textarea id="videoDescription" name="videoDescription" rows="4" placeholder="Enter a detailed description of your video content..."></textarea>
                </div>
                <div class="form-group">
                    <label>Industry</label>
                    <small class="helper-text">Select the primary industry to tailor the script's tone and content</small>
                    <div class="industry-selector" id="industryGroup">
                        <div class="industry-card" data-value="technology">
                            <div class="industry-icon"><i class="fas fa-microchip"></i></div>
                            <div>Technology</div>
                        </div>
                        <div class="industry-card" data-value="healthcare">
                            <div class="industry-icon"><i class="fas fa-heartbeat"></i></div>
                            <div>Healthcare</div>
                        </div>
                        <div class="industry-card" data-value="finance">
                            <div class="industry-icon"><i class="fas fa-chart-line"></i></div>
                            <div>Finance</div>
                        </div>
                        <div class="industry-card" data-value="education">
                            <div class="industry-icon"><i class="fas fa-graduation-cap"></i></div>
                            <div>Education</div>
                        </div>
                        <div class="industry-card" data-value="retail">
                            <div class="industry-icon"><i class="fas fa-shopping-cart"></i></div>
                            <div>Retail</div>
                        </div>
                        <div class="industry-card" data-value="manufacturing">
                            <div class="industry-icon"><i class="fas fa-industry"></i></div>
                            <div>Manufacturing</div>
                        </div>
                        <div class="industry-card" data-value="real-estate">
                            <div class="industry-icon"><i class="fas fa-home"></i></div>
                            <div>Real Estate</div>
                        </div>
                        <div class="industry-card" data-value="hospitality">
                            <div class="industry-icon"><i class="fas fa-hotel"></i></div>
                            <div>Hospitality</div>
                        </div>
                        <div class="industry-card" data-value="food-beverage">
                            <div class="industry-icon"><i class="fas fa-utensils"></i></div>
                            <div>Food & Beverage</div>
                        </div>
                        <div class="industry-card" data-value="entertainment">
                            <div class="industry-icon"><i class="fas fa-film"></i></div>
                            <div>Entertainment</div>
                        </div>
                        <div class="industry-card" data-value="fashion">
                            <div class="industry-icon"><i class="fas fa-tshirt"></i></div>
                            <div>Fashion</div>
                        </div>
                        <div class="industry-card" data-value="automotive">
                            <div class="industry-icon"><i class="fas fa-car"></i></div>
                            <div>Automotive</div>
                        </div>
                        <div class="industry-card" data-value="energy">
                            <div class="industry-icon"><i class="fas fa-bolt"></i></div>
                            <div>Energy</div>
                        </div>
                        <div class="industry-card" data-value="construction">
                            <div class="industry-icon"><i class="fas fa-hard-hat"></i></div>
                            <div>Construction</div>
                        </div>
                        <div class="industry-card" data-value="agriculture">
                            <div class="industry-icon"><i class="fas fa-seedling"></i></div>
                            <div>Agriculture</div>
                        </div>
                        <div class="industry-card" data-value="marketing">
                            <div class="industry-icon"><i class="fas fa-bullhorn"></i></div>
                            <div>Marketing</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Target Audience</label>
                    <small class="helper-text">Select the primary audience segments for your video</small>
                    <div class="audience-section">
                        <div class="audience-tag" data-value="professionals">Professionals</div>
                        <div class="audience-tag" data-value="decision-makers">Decision Makers</div>
                        <div class="audience-tag" data-value="consumers">Consumers</div>
                        <div class="audience-tag" data-value="students">Students</div>
                        <div class="audience-tag" data-value="investors">Investors</div>
                        <div class="audience-tag" data-value="partners">Partners</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="keyMessage">Key Message</label>
                    <small class="helper-text">What's the main message you want to convey to your audience?</small>
                    <textarea id="keyMessage" name="keyMessage" rows="3" placeholder="Enter your key message..."></textarea>
                </div>
                <div class="form-group">
                    <label for="uniqueValue">Unique Value Proposition</label>
                    <small class="helper-text">What makes your company/product/service unique?</small>
                    <textarea id="uniqueValue" name="uniqueValue" rows="3" placeholder="Enter your unique value proposition..."></textarea>
                </div>
                <!-- CTA Selection -->
                <div class="form-group">
                    <label for="cta">Call to Action (CTA)</label>
                    <small class="helper-text">Select the main action you want viewers to take after watching the video</small>
                    <select id="cta" name="cta">
                        <option value="">-- Select a CTA --</option>
                        <option value="visit_website">Visit Website</option>
                        <option value="sign_up">Sign Up</option>
                        <option value="contact_us">Contact Us</option>
                        <option value="learn_more">Learn More</option>
                        <option value="download">Download</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <!-- CTA URL (optional) -->
                <div class="form-group">
                    <label for="ctaUrl">CTA Destination URL (optional)</label>
                    <small class="helper-text">Provide a URL for the CTA if applicable (e.g., landing page, signup form, etc.)</small>
                    <input type="text" id="ctaUrl" name="ctaUrl" placeholder="https://your-link.com">
                </div>
                <div class="form-group">
                    <label>Supporting Content</label>
                    <small class="helper-text">Upload relevant documents to help generate a more personalized script</small>
                    <div class="upload-section">
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Drag and drop files here or click to browse</p>
                            <p class="file-types">Supported formats: PDF, DOCX, TXT, PPT, JPG, PNG, Google Docs, Google Sheets, Google Slides</p>
                            <input type="file" id="contentUpload" multiple style="display: none;" accept=".pdf,.docx,.txt,.ppt,.pptx,.jpg,.jpeg,.png,.gdoc,.gsheet,.gslides">
                        </div>
                        <div class="uploaded-files" id="uploadedFiles"></div>
                        <div class="content-analysis" id="contentAnalysis"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="brand-guidelines" class="tab-content">
            <div class="form-section">
                <div class="section-header">
                    <h2 class="section-title">Brand Guidelines</h2>
                    <p class="section-description">Specify your brand's visual and tonal identity</p>
                </div>
                <div class="form-group">
                    <label>Brand Voice</label>
                    <small class="helper-text">Select the tone that best represents your brand</small>
                    <div class="selection-group" id="brandVoiceGroup">
                        <button type="button" class="selection-button" data-value="professional">Professional</button>
                        <button type="button" class="selection-button" data-value="casual">Casual</button>
                        <button type="button" class="selection-button" data-value="technical">Technical</button>
                        <button type="button" class="selection-button" data-value="inspirational">Inspirational</button>
                        <button type="button" class="selection-button" data-value="other">Other</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="brandColors">Key Brand Colors</label>
                    <small class="helper-text">Enter your brand's primary colors in hex format</small>
                    <input type="text" id="brandColors" name="brandColors" placeholder="e.g., #0071e3, #86868b">
                </div>
                <div class="form-group">
                    <label for="brandFonts">Brand Fonts</label>
                    <small class="helper-text">Specify the fonts used in your brand</small>
                    <input type="text" id="brandFonts" name="brandFonts">
                </div>
            </div>
        </div>

        <div id="technical-specs" class="tab-content">
            <div class="form-section">
                <div class="section-header">
                    <h2 class="section-title">Technical Specifications</h2>
                    <p class="section-description">Set the technical requirements for your video</p>
                </div>
                <div class="form-group">
                    <label>Aspect Ratio</label>
                    <small class="helper-text">Choose the video's width-to-height ratio</small>
                    <div class="selection-group" id="aspectRatioGroup">
                        <button type="button" class="selection-button" data-value="16:9">16:9</button>
                        <button type="button" class="selection-button" data-value="9:16">9:16</button>
                        <button type="button" class="selection-button" data-value="1:1">1:1</button>
                        <button type="button" class="selection-button" data-value="custom">Custom</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Resolution</label>
                    <small class="helper-text">Select the video's pixel dimensions</small>
                    <div class="selection-group" id="resolutionGroup">
                        <button type="button" class="selection-button" data-value="4k">4K (3840x2160)</button>
                        <button type="button" class="selection-button" data-value="1080p">1080p (1920x1080)</button>
                        <button type="button" class="selection-button" data-value="720p">720p (1280x720)</button>
                        <button type="button" class="selection-button" data-value="custom">Custom</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Frame Rate</label>
                    <small class="helper-text">Choose the number of frames per second</small>
                    <div class="selection-group" id="frameRateGroup">
                        <button type="button" class="selection-button" data-value="24">24 fps</button>
                        <button type="button" class="selection-button" data-value="30">30 fps</button>
                        <button type="button" class="selection-button" data-value="60">60 fps</button>
                        <button type="button" class="selection-button" data-value="custom">Custom</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="script-workspace" class="tab-content">
            <div class="form-section">
                <div class="section-header">
                    <h2 class="section-title">Script Workspace</h2>
                    <p class="section-description">Generate, edit, and get feedback on your video script</p>
                </div>
                
                <div class="script-toolbar">
                    <div class="toolbar-group">
                        <button type="button" class="toolbar-button" id="generateScriptBtn">
                            <i class="fas fa-magic"></i> Generate Script
                        </button>
                        <button type="button" class="toolbar-button" id="editScriptBtn">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button type="button" class="toolbar-button" id="saveScriptBtn" style="display: none;">
                            <i class="fas fa-save"></i> Save
                        </button>
                    </div>
                    <div class="toolbar-group">
                        <select class="version-selector" id="scriptVersion">
                            <option value="latest">Latest Version</option>
                            <option value="previous">Previous Version</option>
                            <option value="original">Original Version</option>
                        </select>
                        <span class="version-badge" id="versionBadge">v1.0</span>
                    </div>
                </div>

                <div class="script-workspace">
                    <div class="script-main">
                        <div class="script-header">
                            <div class="script-version-info">
                                <span>Last updated: <span id="lastUpdated">Just now</span></span>
                            </div>
                            <div class="script-controls">
                                <button type="button" class="toolbar-button" data-preview-mode="standard">
                                    <i class="fas fa-file-alt"></i> Standard
                                </button>
                                <button type="button" class="toolbar-button" data-preview-mode="timeline">
                                    <i class="fas fa-clock"></i> Timeline
                                </button>
                                <button type="button" class="toolbar-button" data-preview-mode="split">
                                    <i class="fas fa-columns"></i> Split
                                </button>
                            </div>
                        </div>
                        
                        <div class="script-formatting-toolbar" style="display: none;">
                            <button type="button" class="format-button" data-format="bold">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="format-button" data-format="italic">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="format-button" data-format="heading">
                                <i class="fas fa-heading"></i>
                            </button>
                            <button type="button" class="format-button" data-format="list">
                                <i class="fas fa-list"></i>
                            </button>
                            <button type="button" class="format-button" data-format="timing">
                                <i class="fas fa-clock"></i>
                            </button>
                        </div>

                        <div id="scriptContent" class="script-preview"></div>
                    </div>

                    <div class="script-sidebar">
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages"></div>
                            <div class="chat-input">
                                <input type="text" id="chatInput" placeholder="Ask for feedback or suggestions...">
                                <button type="button" id="sendMessage">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>

                        <div class="feedback-section">
                            <h3>Feedback History</h3>
                            <div id="feedbackList"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="export-options" class="tab-content">
            <div class="form-section">
                <div class="section-header">
                    <h2 class="section-title">Export Options</h2>
                    <p class="section-description">Choose how to export your video script</p>
                </div>
                <div class="export-options">
                    <button type="button" class="export-option" data-export-type="markdown">Markdown</button>
                    <button type="button" class="export-option" data-export-type="pdf">PDF</button>
                    <button type="button" class="export-option" data-export-type="docx">Word</button>
                    <button type="button" class="export-option" data-export-type="txt">Text</button>
                    <button type="button" class="export-option" data-export-type="json">JSON</button>
                    <button type="button" class="export-option" data-export-type="xml">XML</button>
                    <button type="button" class="export-option" data-export-type="finalcut">Final Cut Pro</button>
                    <button type="button" class="export-option" data-export-type="premiere">Premiere Pro</button>
                </div>
            </div>
        </div>
    </form>

    <script>
        // Form data management
        let formData = {
            projectName: '',
            client: '',
            companyUrl: '',
            industry: '',
            targetAudience: [],
            brandVoice: '',
            brandColors: '',
            brandFonts: '',
            keyMessage: '',
            uniqueValue: '',
            cta: '',
            ctaUrl: '',
            duration: '',
            projectType: '',
            targetPlatform: [],
            supportingContent: [],
            contentAnalysis: {}
        };

        // Add chat and feedback functionality
        let chatMessages = [];
        let feedbackItems = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeSelectionButtons();
            loadFormData();
            initializeChat();
            loadSavedData();
            initializeScriptWorkspace();
            initializeUpload();
        });

        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all buttons and contents
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Add active class to clicked button
                    this.classList.add('active');

                    // Show corresponding content
                    const tabId = this.getAttribute('data-tab');
                    const activeContent = document.getElementById(tabId);
                    if (activeContent) {
                        activeContent.classList.add('active');
                    }
                });
            });
        }

        function initializeSelectionButtons() {
            const selectionGroups = document.querySelectorAll('.selection-group');
            
            selectionGroups.forEach(group => {
                const buttons = group.querySelectorAll('.selection-button');
                const isMultiple = group.id === 'targetPlatformGroup';

                buttons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        const value = this.getAttribute('data-value');
                        const groupId = group.id.replace('Group', '');

                        if (isMultiple) {
                            // Toggle selection for multiple select
                            this.classList.toggle('active');
                            
                            // Update formData
                            formData[groupId] = Array.from(group.querySelectorAll('.selection-button.active'))
                                .map(btn => btn.getAttribute('data-value'));
                        } else {
                            // Single selection
                            buttons.forEach(btn => btn.classList.remove('active'));
                            this.classList.add('active');
                            
                            // Update formData
                            formData[groupId] = value;
                        }

                        saveFormData();
                        updateScript();
                    });
                });
            });
        }

        function loadFormData() {
            const savedData = localStorage.getItem('videoScriptFormData');
            if (savedData) {
                formData = JSON.parse(savedData);
                updateUIFromFormData();
            }
        }

        function updateUIFromFormData() {
            // Update selection buttons
            Object.entries(formData).forEach(([key, value]) => {
                const group = document.getElementById(`${key}Group`);
                if (group) {
                    const buttons = group.querySelectorAll('.selection-button');
                    
                    if (Array.isArray(value)) {
                        // Multiple selection
                        buttons.forEach(button => {
                            const buttonValue = button.getAttribute('data-value');
                            button.classList.toggle('active', value.includes(buttonValue));
                        });
                    } else {
                        // Single selection
                        buttons.forEach(button => {
                            const buttonValue = button.getAttribute('data-value');
                            button.classList.toggle('active', buttonValue === value);
                        });
                    }
                }
            });

            // Update text inputs
            const textInputs = ['projectName', 'client', 'companyUrl', 'brandColors', 'brandFonts', 'keyMessage', 'uniqueValue', 'ctaUrl'];
            textInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input && formData[id]) {
                    input.value = formData[id];
                }
            });

            // Update CTA select
            const ctaSelect = document.getElementById('cta');
            if (ctaSelect && formData.cta) {
                ctaSelect.value = formData.cta;
            }
        }

        function saveFormData() {
            localStorage.setItem('videoScriptFormData', JSON.stringify(formData));
        }

        function updateScript() {
            const scriptContent = document.getElementById('scriptContent');
            if (scriptContent) {
                const script = generateScript();
                scriptContent.innerHTML = formatScript(script);
            }
        }

        function generateScript() {
            const script = {
                header: generateScriptHeader(),
                sections: generateScriptSections(),
                technical: generateTechnicalNotes(),
                accessibility: generateAccessibilityNotes(),
                companyInfo: generateCompanyInfo(),
                insights: generateScriptInsights(),
                contentAnalysis: generateContentAnalysis()
            };

            return formatScript(script);
        }

        function generateScriptHeader() {
            return {
                title: formData.projectName || 'Untitled Project',
                client: formData.client || 'Not specified',
                duration: formData.duration || 'Not specified',
                type: formData.projectType || 'Not specified',
                platforms: formData.targetPlatform.join(', ') || 'Not specified'
            };
        }

        function generateScriptSections() {
            const sections = [];
            const duration = parseInt(formData.duration) || 30;
            const timing = calculateTiming(duration);

            // Opening Section
            sections.push({
                title: 'Opening',
                timing: `0:00 - ${timing.opening}`,
                content: generateOpeningSection()
            });

            // Main Content
            sections.push({
                title: 'Main Content',
                timing: `${timing.opening} - ${timing.main}`,
                content: generateMainContent()
            });

            // Call to Action
            sections.push({
                title: 'Call to Action',
                timing: `${timing.main} - ${timing.end}`,
                content: generateCallToAction()
            });

            return sections;
        }

        function generateOpeningSection() {
            const tone = formData.brandVoice || 'professional';
            const projectType = formData.projectType || 'brand';
            
            const openings = {
                professional: {
                    brand: "Welcome to the future of digital excellence.",
                    product: "Introducing our latest innovation.",
                    social: "Prepare to be inspired by our vision.",
                    educational: "Let us guide you through an extraordinary journey."
                },
                casual: {
                    brand: "Hey there! Welcome to something amazing.",
                    product: "Check this out - our newest creation.",
                    social: "Ready for something cool?",
                    educational: "Let's discover something awesome together!"
                },
                technical: {
                    brand: "Experience cutting-edge digital solutions.",
                    product: "Discover our advanced technology.",
                    social: "Explore our innovative platform.",
                    educational: "Learn through our state-of-the-art system."
                },
                inspirational: {
                    brand: "Imagine what's possible.",
                    product: "Dream bigger, achieve more.",
                    social: "Inspire and be inspired.",
                    educational: "Unlock your potential."
                }
            };

            return {
                visual: `[${projectType} style opening with brand elements]`,
                audio: `[${formData.brandVoice} background music]`,
                narration: openings[tone][projectType] || openings[tone].brand
            };
        }

        function generateMainContent() {
            const description = formData.videoDescription || '';
            const duration = parseInt(formData.duration) || 30;
            const mainDuration = Math.floor(duration * 0.5); // 50% of total duration for main content
            
            // If there's a video description, use it to generate more specific content
            if (description) {
                return {
                    visual: `[Visual elements based on description: ${description}]`,
                    audio: `[Background music matching the tone]`,
                    narration: `[Narration based on description: ${description}]`
                };
            }
            
            // Default content if no description is provided
            return {
                visual: '[Dynamic visuals showcasing key features]',
                audio: '[Engaging background music]',
                narration: '[Clear, concise narration of key points]'
            };
        }

        function generateCallToAction() {
            // Use CTA and CTA URL from formData
            const cta = formData.cta || '';
            const ctaUrl = formData.ctaUrl || formData.companyUrl || '';
            let ctaText = '';
            switch (cta) {
                case 'visit_website':
                    ctaText = ctaUrl ? `Visit our website: ${ctaUrl}` : 'Visit our website for more information.';
                    break;
                case 'sign_up':
                    ctaText = ctaUrl ? `Sign up now at ${ctaUrl}` : 'Sign up now to get started!';
                    break;
                case 'contact_us':
                    ctaText = ctaUrl ? `Contact us at ${ctaUrl}` : 'Contact us to learn more.';
                    break;
                case 'learn_more':
                    ctaText = ctaUrl ? `Learn more at ${ctaUrl}` : 'Learn more about what we offer.';
                    break;
                case 'download':
                    ctaText = ctaUrl ? `Download now at ${ctaUrl}` : 'Download now to get started!';
                    break;
                case 'other':
                    ctaText = ctaUrl ? `Take action: ${ctaUrl}` : 'Take the next step today!';
                    break;
                default:
                    ctaText = ctaUrl ? `Ready to begin your journey? Visit ${ctaUrl}` : 'Ready to begin your journey?';
            }
            return {
                visual: `[Clear call-to-action${ctaUrl ? ' with ' + ctaUrl : ''}]`,
                audio: `[Music fades]`,
                narration: ctaText
            };
        }

        function generateTechnicalNotes() {
            return {
                duration: formData.duration || 'Not specified',
                style: formData.brandVoice || 'Not specified',
                aspectRatio: formData.aspectRatio || 'Not specified',
                resolution: formData.resolution || 'Not specified',
                frameRate: formData.frameRate || 'Not specified'
            };
        }

        function generateAccessibilityNotes() {
            return [
                'Subtitles required',
                'Closed captions in multiple languages',
                'Audio description track available',
                'High contrast text elements'
            ];
        }

        function calculateTiming(duration) {
            return {
                opening: Math.floor(duration * 0.2),
                main: Math.floor(duration * 0.7),
                end: duration
            };
        }

        function generateCompanyInfo() {
            return {
                name: formData.client,
                url: formData.companyUrl,
                brandVoice: formData.brandVoice,
                colors: formData.brandColors,
                fonts: formData.brandFonts
            };
        }

        function generateScriptInsights() {
            const industry = formData.industry || '';
            const audience = formData.targetAudience || [];
            const keyMessage = formData.keyMessage || '';
            const uniqueValue = formData.uniqueValue || '';

            return {
                industry: industry,
                audience: audience,
                keyMessage: keyMessage,
                uniqueValue: uniqueValue,
                tone: determineIndustryTone(industry),
                approach: determineAudienceApproach(audience)
            };
        }

        function determineIndustryTone(industry) {
            const tones = {
                technology: 'innovative and forward-thinking',
                healthcare: 'compassionate and trustworthy',
                finance: 'professional and reliable',
                education: 'engaging and informative',
                retail: 'energetic and customer-focused',
                manufacturing: 'precise and efficient'
            };
            return tones[industry] || 'professional';
        }

        function determineAudienceApproach(audience) {
            if (audience.includes('decision-makers')) {
                return 'focus on ROI and strategic benefits';
            } else if (audience.includes('professionals')) {
                return 'emphasize expertise and industry knowledge';
            } else if (audience.includes('consumers')) {
                return 'highlight practical benefits and user experience';
            }
            return 'balanced approach';
        }

        function generateIndustrySpecificContent(industry, keyMessage, uniqueValue) {
            const industryTemplates = {
                technology: `Experience the future of innovation at ${formData.companyUrl}. ${keyMessage} Our cutting-edge solutions ${uniqueValue}, setting new standards in the industry.`,
                healthcare: `At ${formData.companyUrl}, we're committed to transforming healthcare. ${keyMessage} Through ${uniqueValue}, we're making a difference in people's lives.`,
                finance: `Trust in financial excellence with ${formData.companyUrl}. ${keyMessage} Our unique approach ${uniqueValue}, ensuring your financial success.`,
                education: `Empowering minds through education at ${formData.companyUrl}. ${keyMessage} Our innovative methods ${uniqueValue}, shaping the future of learning.`,
                retail: `Discover exceptional shopping experiences at ${formData.companyUrl}. ${keyMessage} We stand out by ${uniqueValue}, redefining retail excellence.`,
                manufacturing: `Leading the way in manufacturing innovation at ${formData.companyUrl}. ${keyMessage} Our commitment to ${uniqueValue} drives industry excellence.`,
                marketing: `Elevate your brand's presence with ${formData.companyUrl}. ${keyMessage} Our strategic approach ${uniqueValue}, delivering measurable results and growth.`
            };

            return industryTemplates[industry] || `Experience excellence at ${formData.companyUrl}. ${keyMessage} We differentiate ourselves through ${uniqueValue}.`;
        }

        function formatScript(script) {
            let formattedScript = '';
            
            // Format header and company info
            formattedScript += formatHeaderAndCompanyInfo(script);
            
            // Format content analysis
            formattedScript += `<div class="script-section">
                <h3>Content Analysis</h3>
                <div class="script-insights">
                    ${script.contentAnalysis.brandElements.length > 0 ? `
                        <div class="insight-item">
                            <i class="fas fa-trademark"></i>
                            <span>Brand Elements: ${script.contentAnalysis.brandElements.join(', ')}</span>
                        </div>
                    ` : ''}
                    ${script.contentAnalysis.keyMessages.length > 0 ? `
                        <div class="insight-item">
                            <i class="fas fa-bullhorn"></i>
                            <span>Key Messages: ${script.contentAnalysis.keyMessages.join(', ')}</span>
                        </div>
                    ` : ''}
                    ${script.contentAnalysis.visualReferences.length > 0 ? `
                        <div class="insight-item">
                            <i class="fas fa-image"></i>
                            <span>Visual References: ${script.contentAnalysis.visualReferences.join(', ')}</span>
                        </div>
                    ` : ''}
                </div>
            </div>`;

            // Format sections
            script.sections.forEach(section => {
                formattedScript += formatScriptSection(section);
            });

            // Format technical and accessibility notes
            formattedScript += formatTechnicalAndAccessibilityNotes(script);

            return formattedScript;
        }

        function formatHeaderAndCompanyInfo(script) {
            return `<div class="script-section">
                <h2>${script.header.title}</h2>
                <div class="script-timing">Duration: ${script.header.duration} seconds</div>
                <div class="script-direction">Client: ${script.header.client}</div>
                <div class="script-direction">Type: ${script.header.type}</div>
                <div class="script-direction">Platforms: ${script.header.platforms}</div>
            </div>
            <div class="script-section">
                <h3>Company Information</h3>
                <div class="script-direction">Company: ${script.companyInfo.name}</div>
                <div class="script-direction">Website: ${script.companyInfo.url}</div>
                <div class="script-direction">Brand Voice: ${script.companyInfo.brandVoice}</div>
                <div class="script-direction">Brand Colors: ${script.companyInfo.colors}</div>
                <div class="script-direction">Brand Fonts: ${script.companyInfo.fonts}</div>
            </div>`;
        }

        function formatScriptSection(section) {
            return `<div class="script-section">
                <h3>${section.title}</h3>
                <div class="script-timing">${section.timing}</div>
                <div class="script-direction">${section.content.visual}</div>
                <div class="script-direction">${section.content.audio}</div>
                <div class="script-narration">${section.content.narration}</div>
            </div>`;
        }

        function formatTechnicalAndAccessibilityNotes(script) {
            return `<div class="script-section">
                <h3>Technical Notes</h3>
                <div class="script-direction">Duration: ${script.technical.duration} seconds</div>
                <div class="script-direction">Style: ${script.technical.style}</div>
                <div class="script-direction">Aspect Ratio: ${script.technical.aspectRatio}</div>
                <div class="script-direction">Resolution: ${script.technical.resolution}</div>
                <div class="script-direction">Frame Rate: ${script.technical.frameRate} fps</div>
            </div>
            <div class="script-section">
                <h3>Accessibility Notes</h3>
                ${script.accessibility.map(note => 
                    `<div class="script-direction">${note}</div>`
                ).join('')}
            </div>`;
        }

        // Export functions
        function handleExport(type) {
            if (!document.getElementById('scriptContent')?.textContent) {
                alert('Please generate a script first');
                return;
            }

            const script = document.getElementById('scriptContent').textContent;
            const fileName = `video-script-${formData.projectName || 'untitled'}`;

            switch(type) {
                case 'markdown':
                    downloadFile(script, `${fileName}.md`, 'text/markdown');
                    break;
                case 'pdf':
                    exportToPDF(script);
                    break;
                case 'docx':
                    exportToWord(script);
                    break;
                case 'txt':
                    downloadFile(script, `${fileName}.txt`, 'text/plain');
                    break;
                case 'json':
                    downloadFile(JSON.stringify(formData, null, 2), `${fileName}.json`, 'application/json');
                    break;
                case 'xml':
                    exportToXML(script);
                    break;
                case 'finalcut':
                    exportToFinalCut(script);
                    break;
                case 'premiere':
                    exportToPremiere(script);
                    break;
                default:
                    alert('Export type not supported');
            }
        }

        function downloadFile(content, fileName, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Initialize export buttons
        document.querySelectorAll('.export-option').forEach(button => {
            button.addEventListener('click', function() {
                const exportType = this.getAttribute('data-export-type');
                handleExport(exportType);
            });
        });

        // Initialize preview controls
        document.querySelectorAll('.preview-option').forEach(button => {
            button.addEventListener('click', function() {
                const mode = this.getAttribute('data-preview-mode');
                setPreviewMode(mode);
                
                // Update active state
                document.querySelectorAll('.preview-option').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
            });
        });

        function setPreviewMode(mode) {
            const container = document.getElementById('previewContainer');
            const scriptContent = document.getElementById('scriptContent');
            
            switch(mode) {
                case 'timeline':
                    container.innerHTML = `
                        <div class="timeline-visualization" id="timelineVisualization"></div>
                        <div id="scriptContent" class="script-preview"></div>
                    `;
                    updateTimelineVisualization();
                    break;
                case 'split':
                    container.innerHTML = `
                        <div class="preview-section">
                            <h3>Timeline</h3>
                            <div class="timeline-visualization" id="timelineVisualization"></div>
                        </div>
                        <div class="preview-section">
                            <h3>Script</h3>
                            <div id="scriptContent" class="script-preview"></div>
                        </div>
                    `;
                    updateTimelineVisualization();
                    break;
                case 'fullscreen':
                    const previewWindow = window.open('', 'Script Preview', 'width=1200,height=800');
                    previewWindow.document.write(`
                        <html>
                            <head>
                                <title>Script Preview</title>
                                <style>
                                    body { 
                                        font-family: 'SF Mono', monospace; 
                                        padding: 20px;
                                        background: #1d1d1f;
                                        color: #f5f5f7;
                                    }
                                    .timeline { margin: 20px 0; }
                                    pre { white-space: pre-wrap; }
                                </style>
                            </head>
                            <body>
                                <div class="timeline" id="timelineVisualization"></div>
                                <pre id="scriptContent"></pre>
                            </body>
                        </html>
                    `);
                    previewWindow.document.getElementById('scriptContent').textContent = 
                        document.getElementById('scriptContent').textContent;
                    updateTimelineVisualization(previewWindow.document);
                    break;
                default:
                    container.innerHTML = `<div id="scriptContent" class="script-preview"></div>`;
            }
            
            // Update script content
            const script = generateScript();
            document.getElementById('scriptContent').textContent = script;
        }

        function updateTimelineVisualization(targetDocument = document) {
            const visualization = targetDocument.getElementById('timelineVisualization');
            if (!visualization) return;

            const duration = parseInt(formData.duration) || 30;
            const sections = calculateTiming(duration);
            const containerWidth = visualization.offsetWidth;
            
            visualization.innerHTML = `
                <div class="timeline-segment" style="left: 0%; width: 20%;">
                    <div class="timeline-label">Opening (0:00 - ${sections.opening}s)</div>
                </div>
                <div class="timeline-segment" style="left: 20%; width: 50%;">
                    <div class="timeline-label">Main (${sections.opening}s - ${sections.main}s)</div>
                </div>
                <div class="timeline-segment" style="left: 70%; width: 30%;">
                    <div class="timeline-label">CTA (${sections.main}s - ${sections.end}s)</div>
                </div>
            `;
        }

        // Add script editing functionality
        document.getElementById('editScriptBtn').addEventListener('click', function() {
            const scriptContent = document.getElementById('scriptContent');
            const formattingToolbar = document.querySelector('.script-formatting-toolbar');
            const saveButton = document.getElementById('saveScriptBtn');
            
            scriptContent.contentEditable = true;
            scriptContent.classList.add('editable');
            formattingToolbar.style.display = 'flex';
            this.style.display = 'none';
            saveButton.style.display = 'inline-flex';
            
            // Initialize formatting buttons
            initializeFormattingButtons();
        });

        document.getElementById('saveScriptBtn').addEventListener('click', function() {
            const scriptContent = document.getElementById('scriptContent');
            const formattingToolbar = document.querySelector('.script-formatting-toolbar');
            const editButton = document.getElementById('editScriptBtn');
            
            scriptContent.contentEditable = false;
            scriptContent.classList.remove('editable');
            formattingToolbar.style.display = 'none';
            this.style.display = 'none';
            editButton.style.display = 'inline-flex';
            
            // Save the edited script
            saveEditedScript(scriptContent.innerHTML);
        });

        function initializeFormattingButtons() {
            const formatButtons = document.querySelectorAll('.format-button');
            
            formatButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const format = this.getAttribute('data-format');
                    applyFormatting(format);
                });
            });
        }

        function applyFormatting(format) {
            const selection = window.getSelection();
            if (!selection.rangeCount) return;

            const range = selection.getRangeAt(0);
            const selectedText = range.toString();
            
            if (!selectedText) return;

            let formattedText = '';
            switch(format) {
                case 'bold':
                    formattedText = `**${selectedText}**`;
                    break;
                case 'italic':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'heading':
                    formattedText = `## ${selectedText}`;
                    break;
                case 'list':
                    formattedText = `- ${selectedText}`;
                    break;
                case 'timing':
                    formattedText = `[${selectedText}]`;
                    break;
            }

            document.execCommand('insertText', false, formattedText);
        }

        function saveEditedScript(content) {
            // Save the edited script to localStorage
            localStorage.setItem('editedScript', content);
            
            // Update the formData with the edited content
            formData.editedScript = content;
            saveFormData();
        }

        // Update the script preview when form data changes
        function updateScript() {
            const scriptContent = document.getElementById('scriptContent');
            if (scriptContent) {
                const script = generateScript();
                scriptContent.innerHTML = formatScript(script);
            }
        }

        function initializeChat() {
            const chatInput = document.getElementById('chatInput');
            const sendButton = document.getElementById('sendMessage');
            const chatMessages = document.getElementById('chatMessages');

            function sendMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    addChatMessage('user', message);
                    chatInput.value = '';
                    
                    // Simulate AI response
                    setTimeout(() => {
                        const response = generateAIResponse(message);
                        addChatMessage('assistant', response);
                    }, 1000);
                }
            }

            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }

        function addChatMessage(type, content) {
            const message = {
                type,
                content,
                timestamp: new Date().toISOString()
            };
            
            chatMessages.push(message);
            updateChatDisplay();
            saveChatMessages();
        }

        function updateChatDisplay() {
            const chatMessagesContainer = document.getElementById('chatMessages');
            chatMessagesContainer.innerHTML = chatMessages.map(message => `
                <div class="chat-message ${message.type}">
                    <div class="message-content">${message.content}</div>
                    <div class="message-time">${formatTimestamp(message.timestamp)}</div>
                </div>
            `).join('');
            
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        }

        function generateAIResponse(message) {
            // Simple response generation based on keywords
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('help') || lowerMessage.includes('how')) {
                return "I can help you improve your script. What specific aspects would you like to focus on?";
            } else if (lowerMessage.includes('tone') || lowerMessage.includes('style')) {
                return "The tone of your script should match your brand voice. Would you like me to suggest some adjustments?";
            } else if (lowerMessage.includes('length') || lowerMessage.includes('duration')) {
                return "I can help you adjust the script length. What's your target duration?";
            } else {
                return "I understand your feedback. Would you like me to suggest some specific improvements to the script?";
            }
        }

        function addFeedback(author, content) {
            const feedback = {
                author,
                content,
                timestamp: new Date().toISOString(),
                likes: 0,
                replies: []
            };
            
            feedbackItems.push(feedback);
            updateFeedbackDisplay();
            saveFeedbackItems();
        }

        function updateFeedbackDisplay() {
            const feedbackList = document.getElementById('feedbackList');
            feedbackList.innerHTML = feedbackItems.map(feedback => `
                <div class="feedback-item">
                    <div class="feedback-header">
                        <span class="feedback-author">${feedback.author}</span>
                        <span class="feedback-time">${formatTimestamp(feedback.timestamp)}</span>
                    </div>
                    <div class="feedback-content">${feedback.content}</div>
                    <div class="feedback-actions">
                        <button class="feedback-action" onclick="likeFeedback('${feedback.timestamp}')">
                            <i class="fas fa-thumbs-up"></i> Like (${feedback.likes})
                        </button>
                        <button class="feedback-action" onclick="replyToFeedback('${feedback.timestamp}')">
                            <i class="fas fa-reply"></i> Reply
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString();
        }

        function saveChatMessages() {
            localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
        }

        function saveFeedbackItems() {
            localStorage.setItem('feedbackItems', JSON.stringify(feedbackItems));
        }

        function loadSavedData() {
            const savedChatMessages = localStorage.getItem('chatMessages');
            const savedFeedbackItems = localStorage.getItem('feedbackItems');
            
            if (savedChatMessages) {
                chatMessages = JSON.parse(savedChatMessages);
                updateChatDisplay();
            }
            
            if (savedFeedbackItems) {
                feedbackItems = JSON.parse(savedFeedbackItems);
                updateFeedbackDisplay();
            }
        }

        // Update script workspace functionality
        document.getElementById('generateScriptBtn').addEventListener('click', function() {
            const script = generateScript();
            updateScriptDisplay(script);
            updateVersionBadge();
            addChatMessage('assistant', 'I\'ve generated a new script based on your project details. Would you like me to explain any part of it?');
        });

        function updateScriptDisplay(script) {
            const scriptContent = document.getElementById('scriptContent');
            scriptContent.innerHTML = formatScript(script);
            updateLastUpdated();
        }

        function updateVersionBadge() {
            const versionBadge = document.getElementById('versionBadge');
            const currentVersion = parseInt(versionBadge.textContent.replace('v', '')) + 1;
            versionBadge.textContent = `v${currentVersion}`;
        }

        function updateLastUpdated() {
            const lastUpdated = document.getElementById('lastUpdated');
            lastUpdated.textContent = new Date().toLocaleTimeString();
        }

        // Initialize script workspace
        function initializeScriptWorkspace() {
            const scriptContent = document.getElementById('scriptContent');
            const editButton = document.getElementById('editScriptBtn');
            const saveButton = document.getElementById('saveScriptBtn');
            const formattingToolbar = document.querySelector('.script-formatting-toolbar');

            editButton.addEventListener('click', function() {
                scriptContent.contentEditable = true;
                scriptContent.classList.add('editable');
                formattingToolbar.style.display = 'flex';
                this.style.display = 'none';
                saveButton.style.display = 'inline-flex';
                initializeFormattingButtons();
            });

            saveButton.addEventListener('click', function() {
                scriptContent.contentEditable = false;
                scriptContent.classList.remove('editable');
                formattingToolbar.style.display = 'none';
                this.style.display = 'none';
                editButton.style.display = 'inline-flex';
                saveEditedScript(scriptContent.innerHTML);
                updateVersionBadge();
                updateLastUpdated();
            });

            // Initialize version selector
            document.getElementById('scriptVersion').addEventListener('change', function() {
                const version = this.value;
                loadScriptVersion(version);
            });
        }

        // Add event listener for projectUrl input
        document.getElementById('companyUrl').addEventListener('input', function(e) {
            let value = e.target.value;
            // Remove any existing protocol
            value = value.replace(/^https?:\/\//, '');
            // Remove any trailing slashes
            value = value.replace(/\/$/, '');
            // Add https:// if not present
            if (value && !value.startsWith('https://') && !value.startsWith('http://')) {
                value = 'https://' + value;
            }
            e.target.value = value;
            formData.companyUrl = value;
            saveFormData();
        });

        // Add industry selection functionality
        document.querySelectorAll('.industry-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.industry-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                formData.industry = this.getAttribute('data-value');
                saveFormData();
                updateScript();
            });
        });

        // Add audience selection functionality
        document.querySelectorAll('.audience-tag').forEach(tag => {
            tag.addEventListener('click', function() {
                this.classList.toggle('active');
                const selectedAudience = Array.from(document.querySelectorAll('.audience-tag.active'))
                    .map(t => t.getAttribute('data-value'));
                formData.targetAudience = selectedAudience;
                saveFormData();
                updateScript();
            });
        });

        // Add file upload functionality
        function initializeUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('contentUpload');
            const uploadedFiles = document.getElementById('uploadedFiles');

            if (!uploadArea || !fileInput || !uploadedFiles) {
                console.error('Required upload elements not found');
                return;
            }

            // Initialize formData if not exists
            if (!window.formData) {
                window.formData = {
                    supportingContent: [],
                    contentAnalysis: {}
                };
            }

            // Click to upload - prevent event bubbling
            uploadArea.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                fileInput.click();
            });

            // Prevent click event from bubbling up to parent elements
            fileInput.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.target.files && e.target.files.length > 0) {
                    handleFiles(e.target.files);
                    // Reset the file input to allow selecting the same file again
                    e.target.value = '';
                }
            });
        }

        async function handleFiles(files) {
            const uploadedFiles = document.getElementById('uploadedFiles');
            if (!uploadedFiles) {
                console.error('Uploaded files container not found');
                return;
            }

            for (const file of files) {
                try {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <span class="file-name">${file.name}</span>
                            <div class="upload-progress">
                                <div class="progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    `;
                    uploadedFiles.appendChild(fileItem);
                    const progressBar = fileItem.querySelector('.progress-bar');

                    // Upload to Supabase
                    const publicUrl = await window.uploadFile(file);
                    
                    // Update UI on success
                    fileItem.classList.add('uploaded');
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <span class="file-name">${file.name}</span>
                            <span class="file-status">Uploaded</span>
                        </div>
                    `;
                    
                    showNotification(`Successfully uploaded ${file.name}`, 'success');
                } catch (error) {
                    console.error('Error uploading file:', error);
                    showNotification(`Error uploading ${file.name}: ${error.message}`, 'error');
                }
            }
        }

        function isValidFileType(file) {
            const validTypes = [
                'application/pdf',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'text/plain',
                'application/vnd.ms-powerpoint',
                'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                'image/jpeg',
                'image/png',
                'application/vnd.google-apps.document',
                'application/vnd.google-apps.spreadsheet',
                'application/vnd.google-apps.presentation'
            ];
            return validTypes.includes(file.type);
        }

        function saveFormData() {
            try {
                localStorage.setItem('videoScriptFormData', JSON.stringify(formData));
            } catch (error) {
                console.error('Error saving form data:', error);
            }
        }

        function loadFormData() {
            try {
                const savedData = localStorage.getItem('videoScriptFormData');
                if (savedData) {
                    formData = JSON.parse(savedData);
                    updateFileList();
                    updateContentAnalysis();
                }
            } catch (error) {
                console.error('Error loading form data:', error);
            }
        }

        // Load saved form data on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadFormData();
            initializeUpload(); // Add this line to initialize upload functionality
        });

        function updateFileList() {
            const uploadedFiles = document.getElementById('uploadedFiles');
            if (!uploadedFiles) {
                console.error('Uploaded files container not found');
                return;
            }
            
            uploadedFiles.innerHTML = formData.supportingContent.map((file, index) => `
                <div class="file-item">
                    <div class="file-info">
                        <i class="fas ${getFileIcon(file.type)} file-icon"></i>
                        <div>
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${file.size}</div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="file-action" onclick="previewFile(${index})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="file-action delete" onclick="deleteFile(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getFileIcon(fileType) {
            if (fileType.includes('pdf')) return 'fa-file-pdf';
            if (fileType.includes('word')) return 'fa-file-word';
            if (fileType.includes('text')) return 'fa-file-alt';
            if (fileType.includes('powerpoint')) return 'fa-file-powerpoint';
            if (fileType.includes('image')) return 'fa-file-image';
            if (fileType.includes('google-apps.document')) return 'fa-file-word';
            if (fileType.includes('google-apps.spreadsheet')) return 'fa-file-excel';
            if (fileType.includes('google-apps.presentation')) return 'fa-file-powerpoint';
            return 'fa-file';
        }

        function previewFile(index) {
            const file = formData.supportingContent[index];
            if (file.type.startsWith('image/')) {
                const modal = document.createElement('div');
                modal.className = 'preview-modal';
                modal.innerHTML = `
                    <div class="preview-content">
                        <button class="close-preview">&times;</button>
                        <div class="preview-image" style="background-image: url(${file.content})"></div>
                    </div>
                `;
                
                modal.querySelector('.close-preview').onclick = () => modal.remove();
                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };
                
                document.body.appendChild(modal);
            } else {
                showNotification('Preview not available for this file type', 'info');
            }
        }

        function deleteFile(index) {
            formData.supportingContent.splice(index, 1);
            saveFormData();
            updateFileList();
            showNotification('File removed successfully', 'success');
        }

        function analyzeContent(file) {
            const analysis = {
                type: file.type,
                name: file.name,
                status: 'Analyzing...',
                insights: []
            };

            // Add to content analysis section
            const analysisItem = document.createElement('div');
            analysisItem.className = 'analysis-item';
            analysisItem.innerHTML = `
                <i class="fas ${getFileIcon(file.type)} analysis-icon"></i>
                <div class="analysis-text">${file.name}</div>
                <div class="analysis-status">Analyzing...</div>
            `;
            contentAnalysis.appendChild(analysisItem);

            // Simulate content analysis
            setTimeout(() => {
                const insights = generateInsights(file);
                analysis.status = 'Analyzed';
                analysis.insights = insights;
                
                // Update analysis display
                analysisItem.querySelector('.analysis-status').textContent = 'Analyzed';
                analysisItem.innerHTML += `
                    <div class="analysis-insights">
                        ${insights.map(insight => `
                            <div class="insight-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>${insight}</span>
                            </div>
                        `).join('')}
                    </div>
                `;

                // Update formData
                formData.contentAnalysis[file.name] = analysis;
                saveFormData();
                updateScript();
            }, 2000);
        }

        function generateInsights(file) {
            const insights = [];
            
            if (file.type.includes('text')) {
                // Analyze text content
                const content = file.content.toLowerCase();
                
                // Look for brand mentions
                if (content.includes(formData.client.toLowerCase())) {
                    insights.push('Contains brand mentions');
                }
                
                // Look for key messages
                if (content.includes('mission') || content.includes('vision')) {
                    insights.push('Contains mission/vision statements');
                }
                
                // Look for product features
                if (content.includes('feature') || content.includes('benefit')) {
                    insights.push('Contains product features/benefits');
                }
            }
            
            if (file.type.includes('image')) {
                insights.push('Contains visual brand elements');
            }
            
            return insights;
        }

        function updateContentAnalysis() {
            contentAnalysis.innerHTML = Object.entries(formData.contentAnalysis)
                .map(([fileName, analysis]) => `
                    <div class="analysis-item">
                        <i class="fas ${getFileIcon(analysis.type)} analysis-icon"></i>
                        <div class="analysis-text">${fileName}</div>
                        <div class="analysis-status">${analysis.status}</div>
                        ${analysis.insights.length > 0 ? `
                            <div class="analysis-insights">
                                ${analysis.insights.map(insight => `
                                    <div class="insight-item">
                                        <i class="fas fa-lightbulb"></i>
                                        <span>${insight}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `).join('');
        }

        function generateContentAnalysis() {
            const analysis = {
                brandElements: [],
                keyMessages: [],
                visualReferences: []
            };

            // Process all uploaded content
            Object.values(formData.contentAnalysis).forEach(fileAnalysis => {
                fileAnalysis.insights.forEach(insight => {
                    if (insight.includes('brand')) {
                        analysis.brandElements.push(insight);
                    } else if (insight.includes('mission') || insight.includes('vision')) {
                        analysis.keyMessages.push(insight);
                    } else if (insight.includes('visual')) {
                        analysis.visualReferences.push(insight);
                    }
                });
            });

            return analysis;
        }

        // Add event listener for CTA select
        document.getElementById('cta').addEventListener('change', function(e) {
            formData.cta = e.target.value;
            saveFormData();
            updateScript();
        });
        // Add event listener for CTA URL input
        document.getElementById('ctaUrl').addEventListener('input', function(e) {
            let value = e.target.value;
            // Remove any existing protocol
            value = value.replace(/^https?:\/\//, '');
            // Remove any trailing slashes
            value = value.replace(/\/$/, '');
            // Add https:// if not present
            if (value && !value.startsWith('https://') && !value.startsWith('http://')) {
                value = 'https://' + value;
            }
            e.target.value = value;
            formData.ctaUrl = value;
            saveFormData();
            updateScript();
        });

        function validateForm() {
            const form = document.getElementById('videoScriptForm');
            if (!form) {
                console.error('Form element not found');
                return false;
            }

            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            const errors = [];

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('invalid');
                    errors.push(`${field.name || field.id} is required`);
                    isValid = false;
                } else {
                    field.classList.remove('invalid');
                }
            });

            // Validate URL format
            const urlField = document.getElementById('websiteUrl');
            if (urlField && urlField.value) {
                try {
                    new URL(urlField.value);
                } catch (e) {
                    urlField.classList.add('invalid');
                    errors.push('Please enter a valid URL');
                    isValid = false;
                }
            }

            // Validate duration
            const durationField = document.getElementById('duration');
            if (durationField) {
                const duration = parseInt(durationField.value);
                if (isNaN(duration) || duration < 10 || duration > 600) {
                    durationField.classList.add('invalid');
                    errors.push('Duration must be between 10 and 600 seconds');
                    isValid = false;
                }
            }

            // Validate video description
            const descriptionField = document.getElementById('videoDescription');
            if (descriptionField && !descriptionField.value.trim()) {
                descriptionField.classList.add('invalid');
                errors.push('Please provide a video description');
                isValid = false;
            }

            if (!isValid) {
                showNotification(errors.join('\n'), 'error');
                return false;
            }

            return true;
        }

        // ... existing code ...
        function initializeUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('contentUpload');
            const uploadedFiles = document.getElementById('uploadedFiles');

            if (!uploadArea || !fileInput || !uploadedFiles) {
                console.error('Required upload elements not found');
                return;
            }

            // Initialize formData if not exists
            if (!window.formData) {
                window.formData = {
                    supportingContent: [],
                    contentAnalysis: {}
                };
            }

            // Click to upload - prevent event bubbling
            uploadArea.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                fileInput.click();
            });

            // Prevent click event from bubbling up to parent elements
            fileInput.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.target.files && e.target.files.length > 0) {
                    handleFiles(e.target.files);
                    // Reset the file input to allow selecting the same file again
                    e.target.value = '';
                }
            });
        }

        // Improved file handling with chunked upload support
        async function handleFiles(files) {
            const MAX_FILE_SIZE = 50 * 1024 * 1024; // Increased to 50MB
            const CHUNK_SIZE = 1024 * 1024; // 1MB chunks
            const MAX_CONCURRENT_UPLOADS = 3;
            const uploadedFiles = document.getElementById('uploadedFiles');
            if (!uploadedFiles) return;

            const fileArray = Array.from(files);
            const uploadQueue = new Map();
            let activeUploads = 0;

            for (const file of fileArray) {
                if (!isValidFileType(file)) {
                    showNotification(`Invalid file type: ${file.name}`, 'error');
                    continue;
                }

                if (file.size > MAX_FILE_SIZE) {
                    showNotification(`File too large (max ${formatFileSize(MAX_FILE_SIZE)}): ${file.name}`, 'error');
                    continue;
                }

                // Create file item with progress bar
                const fileItem = createFileItem(file);
                uploadedFiles.appendChild(fileItem);
                const progressBar = fileItem.querySelector('.progress-bar');
                const progressFill = fileItem.querySelector('.progress-fill');

                // Add to upload queue
                uploadQueue.set(file, {
                    fileItem,
                    progressBar,
                    progressFill,
                    status: 'pending'
                });
            }

            // Process upload queue
            while (uploadQueue.size > 0) {
                const pendingUploads = Array.from(uploadQueue.entries())
                    .filter(([_, data]) => data.status === 'pending');

                if (pendingUploads.length === 0) break;

                const uploadsToStart = pendingUploads.slice(0, MAX_CONCURRENT_UPLOADS - activeUploads);
                
                for (const [file, data] of uploadsToStart) {
                    activeUploads++;
                    data.status = 'uploading';
                    
                    try {
                        await uploadFileWithProgress(file, data, CHUNK_SIZE);
                        data.status = 'completed';
                        showNotification(`Successfully uploaded: ${file.name}`, 'success');
                    } catch (error) {
                        data.status = 'failed';
                        console.error('Upload error:', error);
                        showNotification(`Failed to upload ${file.name}: ${error.message}`, 'error');
                        
                        // Add retry button
                        const retryButton = document.createElement('button');
                        retryButton.className = 'retry-button';
                        retryButton.innerHTML = '<i class="fas fa-redo"></i> Retry';
                        retryButton.onclick = () => {
                            data.status = 'pending';
                            retryButton.remove();
                            handleFiles([file]);
                        };
                        data.fileItem.querySelector('.file-actions').appendChild(retryButton);
                    } finally {
                        activeUploads--;
                        uploadQueue.delete(file);
                    }
                }
            }
        }

        async function uploadFileWithProgress(file, data, chunkSize) {
            const { fileItem, progressBar, progressFill } = data;
            const totalChunks = Math.ceil(file.size / chunkSize);
            let uploadedChunks = 0;

            // Show progress bar
            progressBar.style.display = 'block';

            try {
                for (let start = 0; start < file.size; start += chunkSize) {
                    const chunk = file.slice(start, start + chunkSize);
                    const formData = new FormData();
                    formData.append('chunk', chunk);
                    formData.append('chunkNumber', Math.floor(start / chunkSize) + 1);
                    formData.append('totalChunks', totalChunks);
                    formData.append('fileName', file.name);

                    const response = await fetch('/upload/chunk', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`Failed to upload chunk ${uploadedChunks + 1}/${totalChunks}`);
                    }

                    uploadedChunks++;
                    const progress = (uploadedChunks / totalChunks) * 100;
                    progressFill.style.width = `${progress}%`;
                    
                    // Update status text
                    const statusText = fileItem.querySelector('.upload-status');
                    statusText.textContent = `Uploading... ${Math.round(progress)}%`;
                }

                // Hide progress bar and show completion
                progressBar.style.display = 'none';
                const statusText = fileItem.querySelector('.upload-status');
                statusText.textContent = 'Upload complete';
                statusText.className = 'upload-status completed';

                // Add file to formData
                const fileData = {
                    name: file.name,
                    type: file.type,
                    size: formatFileSize(file.size),
                    uploadedAt: new Date().toISOString()
                };

                if (!window.formData) {
                    window.formData = {
                        supportingContent: [],
                        contentAnalysis: {}
                    };
                }

                window.formData.supportingContent.push(fileData);
                saveFormData();
                updateFileList();

            } catch (error) {
                console.error('Upload error:', error);
                throw error;
            }
        }

        function createFileItem(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            
            const fileSize = formatFileSize(file.size);
            const isImage = file.type.startsWith('image/');
            
            fileItem.innerHTML = `
                <div class="file-info">
                    <i class="fas ${getFileIcon(file.type)} file-icon"></i>
                    <div class="file-details">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${fileSize}</div>
                        <div class="upload-status">Preparing upload...</div>
                    </div>
                </div>
                <div class="file-actions">
                    <button type="button" class="file-preview" onclick="previewFile(this)" ${!isImage ? 'disabled' : ''}>
                        <i class="fas fa-eye"></i>
                    </button>
                    <button type="button" class="file-remove" onclick="removeFile(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="progress-bar" style="display: none;">
                    <div class="progress-fill"></div>
                </div>
            `;

            // Add preview for images
            if (isImage) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.createElement('div');
                    preview.className = 'file-preview-image';
                    preview.style.backgroundImage = `url(${e.target.result})`;
                    fileItem.querySelector('.file-info').appendChild(preview);
                };
                reader.readAsDataURL(file);
            }

            return fileItem;
        }

        function getFileIcon(fileType) {
            const iconMap = {
                'application/pdf': 'fa-file-pdf',
                'application/msword': 'fa-file-word',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'fa-file-word',
                'text/plain': 'fa-file-alt',
                'text/html': 'fa-file-code',
                'image/': 'fa-file-image',
                'application/vnd.google-apps.document': 'fa-file-word',
                'application/vnd.google-apps.spreadsheet': 'fa-file-excel',
                'application/vnd.google-apps.presentation': 'fa-file-powerpoint'
            };

            for (const [type, icon] of Object.entries(iconMap)) {
                if (fileType.includes(type)) return icon;
            }
            return 'fa-file';
        }

        function previewFile(button) {
            const fileItem = button.closest('.file-item');
            const previewImage = fileItem.querySelector('.file-preview-image');
            
            if (previewImage) {
                const modal = document.createElement('div');
                modal.className = 'preview-modal';
                modal.innerHTML = `
                    <div class="preview-content">
                        <button class="close-preview">&times;</button>
                        <div class="preview-image" style="background-image: url(${previewImage.style.backgroundImage.slice(4, -1)})"></div>
                    </div>
                `;
                
                modal.querySelector('.close-preview').onclick = () => modal.remove();
                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };
                
                document.body.appendChild(modal);
            }
        }

        function removeFile(button) {
            const fileItem = button.closest('.file-item');
            if (fileItem) {
                fileItem.classList.add('removing');
                setTimeout(() => fileItem.remove(), 300);
            }
        }

        // Add necessary CSS styles
        const style = document.createElement('style');
        style.textContent = `
            .file-item {
                position: relative;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px;
                background: #f8f9fa;
                border-radius: 6px;
                margin-bottom: 8px;
                transition: all 0.3s ease;
            }

            .file-item.removing {
                transform: translateX(100%);
                opacity: 0;
            }

            .file-info {
                display: flex;
                align-items: center;
                gap: 12px;
                flex: 1;
            }

            .file-details {
                flex: 1;
            }

            .file-name {
                font-weight: 500;
                color: #333;
                margin-bottom: 4px;
            }

            .file-size {
                font-size: 12px;
                color: #666;
            }

            .upload-status {
                font-size: 12px;
                color: #666;
                margin-top: 4px;
            }

            .upload-status.completed {
                color: #28a745;
            }

            .file-actions {
                display: flex;
                gap: 8px;
            }

            .file-actions button {
                background: none;
                border: none;
                padding: 4px;
                cursor: pointer;
                color: #666;
                transition: color 0.2s ease;
            }

            .file-actions button:hover {
                color: #333;
            }

            .file-actions button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .progress-bar {
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 3px;
                background: #e9ecef;
                border-radius: 0 0 6px 6px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: #007bff;
                width: 0;
                transition: width 0.3s ease;
            }

            .file-preview-image {
                width: 40px;
                height: 40px;
                background-size: cover;
                background-position: center;
                border-radius: 4px;
                margin-right: 12px;
            }

            .preview-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            }

            .preview-content {
                position: relative;
                max-width: 90%;
                max-height: 90%;
            }

            .preview-image {
                max-width: 100%;
                max-height: 90vh;
                background-size: contain;
                background-position: center;
                background-repeat: no-repeat;
            }

            .close-preview {
                position: absolute;
                top: -40px;
                right: 0;
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
            }

            .retry-button {
                background: #dc3545;
                color: white;
                border: none;
                padding: 4px 8px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
                display: flex;
                align-items: center;
                gap: 4px;
            }

            .retry-button:hover {
                background: #c82333;
            }
        `;
        document.head.appendChild(style);

        // Initialize file upload functionality when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeUpload();
        });
    </script>
</body>
</html> 